<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test ChatBot - Formulaire de Collecte</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        
        .header {
            background: #4f46e5;
            color: white;
            padding: 24px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .form-content {
            padding: 32px;
        }
        
        .progress-bar {
            background: #f1f5f9;
            height: 6px;
            border-radius: 3px;
            margin-bottom: 24px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: #4f46e5;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .question-group {
            margin-bottom: 24px;
            padding: 20px;
            background: #fafbfc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .question-group.active {
            background: #f8faff;
            border-color: #4f46e5;
        }
        
        label {
            display: block;
            font-weight: 500;
            color: #374151;
            margin-bottom: 6px;
            font-size: 1em;
        }
        
        .required {
            color: #ef4444;
        }
        
        input[type="text"], input[type="email"], select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.95em;
            transition: all 0.2s ease;
            background: white;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            transition: all 0.2s ease;
        }
        
        .checkbox-item:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
            accent-color: #4f46e5;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-save {
            background: #f59e0b;
            color: white;
        }
        
        .btn-save:hover {
            background: #d97706;
            transform: translateY(-1px);
        }
        
        .btn-send {
            background: #8b5cf6;
            color: white;
        }
        
        .btn-send:hover {
            background: #7c3aed;
            transform: translateY(-1px);
        }
        
        .btn-export {
            background: #10b981;
            color: white;
        }
        
        .btn-export:hover {
            background: #059669;
            transform: translateY(-1px);
        }
        
        .btn-clear {
            background: #ef4444;
            color: white;
        }
        
        .btn-clear:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        .btn-view {
            background: #3b82f6;
            color: white;
        }
        
        .btn-view:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        
        .status-message {
            text-align: center;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-weight: 500;
        }
        
        .success {
            background: #f0fdf4;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        
        .warning {
            background: #fffbeb;
            color: #92400e;
            border: 1px solid #fde68a;
        }
        
        .question-counter {
            background: #4f46e5;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            display: inline-block;
            margin-bottom: 12px;
            font-weight: 500;
        }
        
        .help-text {
            font-size: 0.85em;
            color: #6b7280;
            margin-top: 4px;
            font-style: normal;
        }
        
        .subtheme-section {
            margin: 16px 0;
            padding: 16px;
            background: #fefefe;
            border-radius: 8px;
            border-left: 3px solid;
        }
        
        .subtheme-section.absences { border-left-color: #3b82f6; }
        .subtheme-section.annulation { border-left-color: #ef4444; }
        .subtheme-section.conseil { border-left-color: #f59e0b; }
        .subtheme-section.controle { border-left-color: #10b981; }

        /* Styles pour la modal des questions sauvegard√©es */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 0;
            border: none;
            width: 90%;
            max-width: 1000px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            background: #4f46e5;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5em;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .close:hover,
        .close:focus {
            background: rgba(255,255,255,0.2);
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .questions-summary {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
        }

        .summary-item {
            text-align: center;
            flex: 1;
        }

        .summary-number {
            font-size: 1.8em;
            font-weight: bold;
            color: #4f46e5;
            display: block;
        }

        .summary-label {
            font-size: 0.9em;
            color: #6b7280;
        }

        .question-card {
            background: #fafbfc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .question-card:hover {
            border-color: #4f46e5;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .question-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #4f46e5;
            margin: 0;
        }

        .question-date {
            color: #6b7280;
            font-size: 0.9em;
        }

        .question-details {
            display: grid;
            gap: 10px;
        }

        .detail-row {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 10px;
            align-items: start;
        }

        .detail-label {
            font-weight: 500;
            color: #374151;
            font-size: 0.9em;
        }

        .detail-content {
            color: #6b7280;
            word-break: break-word;
            font-size: 0.9em;
        }

        .detail-content.long {
            max-height: 60px;
            overflow: hidden;
            position: relative;
        }

        .detail-content.long.expanded {
            max-height: none;
        }

        .expand-btn {
            color: #4f46e5;
            cursor: pointer;
            font-size: 0.8em;
            margin-top: 5px;
            text-decoration: underline;
        }

        .expand-btn:hover {
            color: #7c3aed;
        }

        .no-questions {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }

        .no-questions h3 {
            margin-bottom: 10px;
            color: #374151;
        }
        
        @media (max-width: 768px) {
            .form-content {
                padding: 20px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                margin: 5px 0;
            }

            .modal-content {
                margin: 10px;
                width: calc(100% - 20px);
                max-height: 90vh;
            }

            .questions-summary {
                flex-direction: column;
                gap: 10px;
            }

            .detail-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Test ChatBot - Collecte de donn√©es</h1>
            <p>Formulaire pour l'√©valuation des r√©ponses du ChatBot</p>
        </div>
        
        <div class="form-content">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div id="statusMessage"></div>
            
            <form id="chatbotForm">
                <!-- Informations g√©n√©rales -->
                <div class="question-group">
                    <label for="userName">Nom et Email <span class="required">*</span></label>
                    <input type="email" id="userName" name="userName" required 
                           placeholder="prenom.nom@entreprise.com">
                </div>
                
                <!-- Question en cours -->
                <div class="question-group">
                    <div class="question-counter">Question <span id="questionNumber">1</span> sur 5</div>
                    <label for="questionNum">Num√©ro de la question <span class="required">*</span></label>
                    <select id="questionNum" name="questionNum" required>
                        <option value="">S√©lectionnez...</option>
                        <option value="1">Question 1</option>
                        <option value="2">Question 2</option>
                        <option value="3">Question 3</option>
                        <option value="4">Question 4</option>
                        <option value="5">Question 5</option>
                    </select>
                </div>
                
                <!-- Th√®mes concern√©s -->
                <div class="question-group">
                    <label>Th√®mes concern√©s par cette question <span class="required">*</span></label>
                    <p class="help-text">Cochez tous les th√®mes que votre question aborde</p>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="theme1" name="themes" value="Absences">
                            <label for="theme1">Absences</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="theme2" name="themes" value="Annulation">
                            <label for="theme2">Annulation</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="theme3" name="themes" value="Conseil">
                            <label for="theme3">Conseil</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="theme4" name="themes" value="Contr√¥le">
                            <label for="theme4">Contr√¥le</label>
                        </div>
                    </div>
                </div>
                
                <!-- Sous-th√®mes concern√©s -->
                <div class="question-group">
                    <label>Sous-th√®mes concern√©s par cette question <span class="required">*</span></label>
                    <p class="help-text">Cochez tous les sous-th√®mes que votre question aborde</p>
                    
                    <!-- Absences -->
                    <h4 style="color: #3b82f6; margin: 15px 0 10px 0; font-size: 1.1em;">üìã Absences</h4>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="subtheme1" name="subThemes" value="Absence entretien">
                            <label for="subtheme1">Absence entretien</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="subtheme2" name="subThemes" value="Annonce d'une absence">
                            <label for="subtheme2">Annonce d'une absence</label>
                        </div>
                    </div>
                    
                    <!-- Annulation -->
                    <h4 style="color: #ef4444; margin: 15px 0 10px 0; font-size: 1.1em;">‚ùå Annulation</h4>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="subtheme3" name="subThemes" value="Annulation d'un dossier">
                            <label for="subtheme3">Annulation d'un dossier</label>
                        </div>
                    </div>
                    
                    <!-- Conseil -->
                    <h4 style="color: #f59e0b; margin: 15px 0 10px 0; font-size: 1.1em;">üí° Conseil</h4>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="subtheme4" name="subThemes" value="Diagnostic d'insertion">
                            <label for="subtheme4">Diagnostic d'insertion</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="subtheme5" name="subThemes" value="√âvaluation approfondie">
                            <label for="subtheme5">√âvaluation approfondie</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="subtheme6" name="subThemes" value="Fin de droit">
                            <label for="subtheme6">Fin de droit</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="subtheme7" name="subThemes" value="Mesures d'insertion">
                            <label for="subtheme7">Mesures d'insertion</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="subtheme8" name="subThemes" value="Octroi STAFE">
                            <label for="subtheme8">Octroi STAFE</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="subtheme9" name="subThemes" value="Strat√©gie de r√©insertion">
                            <label for="subtheme9">Strat√©gie de r√©insertion</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="subtheme10" name="subThemes" value="Structure des entretiens">
                            <label for="subtheme10">Structure des entretiens</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="subtheme11" name="subThemes" value="Task Force Entretiens">
                            <label for="subtheme11">Task Force Entretiens</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="subtheme12" name="subThemes" value="Visioconf√©rence">
                            <label for="subtheme12">Visioconf√©rence</label>
                        </div>
                    </div>
                    
                    <!-- Contr√¥le -->
                    <h4 style="color: #10b981; margin: 15px 0 10px 0; font-size: 1.1em;">üîç Contr√¥le</h4>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="subtheme13" name="subThemes" value="Aptitude au placement">
                            <label for="subtheme13">Aptitude au placement</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="subtheme14" name="subThemes" value="Restitution des recherches d'emploi">
                            <label for="subtheme14">Restitution des recherches d'emploi</label>
                        </div>
                    </div>
                </div>
                
                <!-- Question pos√©e -->
                <div class="question-group">
                    <label for="questionAsked">Question pos√©e au ChatBot <span class="required">*</span></label>
                    <p class="help-text">Copiez-collez exactement la question que vous avez pos√©e</p>
                    <textarea id="questionAsked" name="questionAsked" required 
                              placeholder="Coller votre question ici..."></textarea>
                </div>
                
                <!-- R√©ponse re√ßue -->
                <div class="question-group">
                    <label for="botResponse">R√©ponse re√ßue du ChatBot <span class="required">*</span></label>
                    <p class="help-text">Copiez-collez la r√©ponse compl√®te du ChatBot</p>
                    <textarea id="botResponse" name="botResponse" required 
                              placeholder="Coller la r√©ponse du ChatBot ici..."></textarea>
                </div>
                
                <!-- Documents de r√©f√©rence attendus -->
                <div class="question-group">
                    <label>Documents de r√©f√©rence attendus <span class="required">*</span></label>
                    <p class="help-text">Cochez tous les documents qui devraient √™tre la r√©f√©rence pour cette r√©ponse</p>
                    
                    <!-- ABSENCES -->
                    <div class="subtheme-section absences">
                        <h4 style="color: #3b82f6; margin: 0 0 15px 0; font-size: 1.2em;">üìã ABSENCES</h4>
                        
                        <!-- Absence entretien -->
                        <h5 style="color: #374151; margin: 10px 0 8px 0;">Absence entretien</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ent1" name="expectedDocuments" value="Entretien avant MMT.docx">
                                <label for="doc_abs_ent1">Entretien avant MMT.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ent2" name="expectedDocuments" value="DOC 002 Absences EC tableau synth√®se.docx">
                                <label for="doc_abs_ent2">DOC 002 Absences EC tableau synth√®se.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ent3" name="expectedDocuments" value="MAR 010 Management transmission au DJ">
                                <label for="doc_abs_ent3">MAR 010 Management transmission au DJ</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ent4" name="expectedDocuments" value="MAR 003 Annulation dossier DE">
                                <label for="doc_abs_ent4">MAR 003 Annulation dossier DE</label>
                            </div>
                        </div>
                        
                        <!-- Annonce d'une absence -->
                        <h5 style="color: #374151; margin: 15px 0 8px 0;">Annonce d'une absence</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann1" name="expectedDocuments" value="Entretien de conseil (EC) apr√®s MMT">
                                <label for="doc_abs_ann1">Entretien de conseil (EC) apr√®s MMT</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann2" name="expectedDocuments" value="All√©gement de conseil et de contr√¥le.docx">
                                <label for="doc_abs_ann2">All√©gement de conseil et de contr√¥le.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann3" name="expectedDocuments" value="APG Adoption.pdf">
                                <label for="doc_abs_ann3">APG Adoption.pdf</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann4" name="expectedDocuments" value="APG Allocation √† l'autre parent (au p√®re ou √† l'√©pouse de la m√®re).docx">
                                <label for="doc_abs_ann4">APG Allocation √† l'autre parent (au p√®re ou √† l'√©pouse de la m√®re).docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann5" name="expectedDocuments" value="APG Allocations de maternit√©.docx">
                                <label for="doc_abs_ann5">APG Allocations de maternit√©.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann6" name="expectedDocuments" value="APG Allocations de prise en charge enfants.docx">
                                <label for="doc_abs_ann6">APG Allocations de prise en charge enfants.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann7" name="expectedDocuments" value="Incapacit√© de travail.docx">
                                <label for="doc_abs_ann7">Incapacit√© de travail.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann8" name="expectedDocuments" value="Jours sans contr√¥le.docx">
                                <label for="doc_abs_ann8">Jours sans contr√¥le.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann9" name="expectedDocuments" value="OFAS">
                                <label for="doc_abs_ann9">OFAS</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann10" name="expectedDocuments" value="DFAS">
                                <label for="doc_abs_ann10">DFAS</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann11" name="expectedDocuments" value="OFSO">
                                <label for="doc_abs_ann11">OFSO</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann12" name="expectedDocuments" value="SUVA">
                                <label for="doc_abs_ann12">SUVA</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann13" name="expectedDocuments" value="S√©curit√© social CHSS">
                                <label for="doc_abs_ann13">S√©curit√© social CHSS</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann14" name="expectedDocuments" value="AVS/AI Allocation √† l'autre parent AAP">
                                <label for="doc_abs_ann14">AVS/AI Allocation √† l'autre parent AAP</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann15" name="expectedDocuments" value="AVS/AI Allocation de maternit√© AMat">
                                <label for="doc_abs_ann15">AVS/AI Allocation de maternit√© AMat</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann16" name="expectedDocuments" value="AVS/AI Allocation de prise en charge APC">
                                <label for="doc_abs_ann16">AVS/AI Allocation de prise en charge APC</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann17" name="expectedDocuments" value="MAR 009 Incapacit√© de travail">
                                <label for="doc_abs_ann17">MAR 009 Incapacit√© de travail</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_abs_ann18" name="expectedDocuments" value="MAR 005 √âv√©nement">
                                <label for="doc_abs_ann18">MAR 005 √âv√©nement</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ANNULATION -->
                    <div class="subtheme-section annulation">
                        <h4 style="color: #ef4444; margin: 0 0 15px 0; font-size: 1.2em;">‚ùå ANNULATION</h4>
                        
                        <!-- Annulation d'un dossier -->
                        <h5 style="color: #374151; margin: 10px 0 8px 0;">Annulation d'un dossier</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_ann1" name="expectedDocuments" value="Effectuer une annulation.docx">
                                <label for="doc_ann1">Effectuer une annulation.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_ann2" name="expectedDocuments" value="DOC 006 Annulation dossiers morts et d√©lais">
                                <label for="doc_ann2">DOC 006 Annulation dossiers morts et d√©lais</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_ann3" name="expectedDocuments" value="MAR 003 Annulation dossier DE">
                                <label for="doc_ann3">MAR 003 Annulation dossier DE</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CONSEIL -->
                    <div class="subtheme-section conseil">
                        <h4 style="color: #f59e0b; margin: 0 0 15px 0; font-size: 1.2em;">üí° CONSEIL</h4>
                        
                        <!-- Diagnostic d'insertion -->
                        <h5 style="color: #374151; margin: 10px 0 8px 0;">Diagnostic d'insertion</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_diag1" name="expectedDocuments" value="1er entretien de conseil (Diag).docx">
                                <label for="doc_cons_diag1">1er entretien de conseil (Diag).docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_diag2" name="expectedDocuments" value="DOC 007 Checklist EC">
                                <label for="doc_cons_diag2">DOC 007 Checklist EC</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_diag3" name="expectedDocuments" value="DOC 004 EC pr√©sentiel, visio ou t√©l√©phone">
                                <label for="doc_cons_diag3">DOC 004 EC pr√©sentiel, visio ou t√©l√©phone</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_diag4" name="expectedDocuments" value="MAR 005 √âv√©nement">
                                <label for="doc_cons_diag4">MAR 005 √âv√©nement</label>
                            </div>
                        </div>
                        
                        <!-- √âvaluation approfondie -->
                        <h5 style="color: #374151; margin: 15px 0 8px 0;">√âvaluation approfondie</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_eval1" name="expectedDocuments" value="√âvaluation approfondie.docx">
                                <label for="doc_cons_eval1">√âvaluation approfondie.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_eval2" name="expectedDocuments" value="DOC 007 Checklist EC">
                                <label for="doc_cons_eval2">DOC 007 Checklist EC</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_eval3" name="expectedDocuments" value="DOC 004 EC pr√©sentiel, visio ou t√©l√©phone">
                                <label for="doc_cons_eval3">DOC 004 EC pr√©sentiel, visio ou t√©l√©phone</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_eval4" name="expectedDocuments" value="MAR 005 √âv√©nement">
                                <label for="doc_cons_eval4">MAR 005 √âv√©nement</label>
                            </div>
                        </div>
                        
                        <!-- Fin de droit -->
                        <h5 style="color: #374151; margin: 15px 0 8px 0;">Fin de droit</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_fin1" name="expectedDocuments" value="Fin d'indemnisation.docx">
                                <label for="doc_cons_fin1">Fin d'indemnisation.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_fin2" name="expectedDocuments" value="DOC 007 Checklist EC">
                                <label for="doc_cons_fin2">DOC 007 Checklist EC</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_fin3" name="expectedDocuments" value="DOC 004 EC pr√©sentiel, visio ou t√©l√©phone">
                                <label for="doc_cons_fin3">DOC 004 EC pr√©sentiel, visio ou t√©l√©phone</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_fin4" name="expectedDocuments" value="MAR 005 √âv√©nement">
                                <label for="doc_cons_fin4">MAR 005 √âv√©nement</label>
                            </div>
                        </div>
                        
                        <!-- Mesures d'insertion -->
                        <h5 style="color: #374151; margin: 15px 0 8px 0;">Mesures d'insertion</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_mes1" name="expectedDocuments" value="Mesures d'insertion.docx">
                                <label for="doc_cons_mes1">Mesures d'insertion.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_mes2" name="expectedDocuments" value="DOC 007 Checklist EC">
                                <label for="doc_cons_mes2">DOC 007 Checklist EC</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_mes3" name="expectedDocuments" value="DOC 004 EC pr√©sentiel, visio ou t√©l√©phone">
                                <label for="doc_cons_mes3">DOC 004 EC pr√©sentiel, visio ou t√©l√©phone</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_mes4" name="expectedDocuments" value="MAR 005 √âv√©nement">
                                <label for="doc_cons_mes4">MAR 005 √âv√©nement</label>
                            </div>
                        </div>
                        
                        <!-- Octroi STAFE -->
                        <h5 style="color: #374151; margin: 15px 0 8px 0;">Octroi STAFE</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_oct1" name="expectedDocuments" value="Octroyer un STAFE.docx">
                                <label for="doc_cons_oct1">Octroyer un STAFE.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_oct2" name="expectedDocuments" value="DOC 007 Checklist EC">
                                <label for="doc_cons_oct2">DOC 007 Checklist EC</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_oct3" name="expectedDocuments" value="DOC 004 EC pr√©sentiel, visio ou t√©l√©phone">
                                <label for="doc_cons_oct3">DOC 004 EC pr√©sentiel, visio ou t√©l√©phone</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_oct4" name="expectedDocuments" value="MAR 005 √âv√©nement">
                                <label for="doc_cons_oct4">MAR 005 √âv√©nement</label>
                            </div>
                        </div>
                        
                        <!-- Strat√©gie de r√©insertion -->
                        <h5 style="color: #374151; margin: 15px 0 8px 0;">Strat√©gie de r√©insertion</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_str1" name="expectedDocuments" value="√âtablir la strat√©gie.docx">
                                <label for="doc_cons_str1">√âtablir la strat√©gie.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_str2" name="expectedDocuments" value="Fiches pratiques - Crit√®res d'employabilit√©.docx">
                                <label for="doc_cons_str2">Fiches pratiques - Crit√®res d'employabilit√©.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_str3" name="expectedDocuments" value="Nomenclature des objectifs.docx">
                                <label for="doc_cons_str3">Nomenclature des objectifs.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_str4" name="expectedDocuments" value="DOC 007 Checklist EC">
                                <label for="doc_cons_str4">DOC 007 Checklist EC</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_str5" name="expectedDocuments" value="DOC 004 EC pr√©sentiel, visio ou t√©l√©phone">
                                <label for="doc_cons_str5">DOC 004 EC pr√©sentiel, visio ou t√©l√©phone</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_str6" name="expectedDocuments" value="MAR 006 R√©insertion Plan actions">
                                <label for="doc_cons_str6">MAR 006 R√©insertion Plan actions</label>
                            </div>
                        </div>
                        
                        <!-- Structure des entretiens -->
                        <h5 style="color: #374151; margin: 15px 0 8px 0;">Structure des entretiens</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_struct1" name="expectedDocuments" value="Structure des entretiens.docx">
                                <label for="doc_cons_struct1">Structure des entretiens.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_struct2" name="expectedDocuments" value="DOC 007 Checklist EC">
                                <label for="doc_cons_struct2">DOC 007 Checklist EC</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_struct3" name="expectedDocuments" value="DOC 004 EC pr√©sentiel, visio ou t√©l√©phone">
                                <label for="doc_cons_struct3">DOC 004 EC pr√©sentiel, visio ou t√©l√©phone</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_struct4" name="expectedDocuments" value="MAR 005 √âv√©nement">
                                <label for="doc_cons_struct4">MAR 005 √âv√©nement</label>
                            </div>
                        </div>
                        
                        <!-- Task Force Entretiens -->
                        <h5 style="color: #374151; margin: 15px 0 8px 0;">Task Force Entretiens</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_task1" name="expectedDocuments" value="Task Force EC.docx">
                                <label for="doc_cons_task1">Task Force EC.docx</label>
                            </div>
                        </div>
                        
                        <!-- Visioconf√©rence -->
                        <h5 style="color: #374151; margin: 15px 0 8px 0;">Visioconf√©rence</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_visio1" name="expectedDocuments" value="Guide et consignes.docx">
                                <label for="doc_cons_visio1">Guide et consignes.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_visio2" name="expectedDocuments" value="DOC 007 Checklist EC">
                                <label for="doc_cons_visio2">DOC 007 Checklist EC</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_visio3" name="expectedDocuments" value="DOC 004 EC pr√©sentiel, visio ou t√©l√©phone">
                                <label for="doc_cons_visio3">DOC 004 EC pr√©sentiel, visio ou t√©l√©phone</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_cons_visio4" name="expectedDocuments" value="MAR 005 √âv√©nement">
                                <label for="doc_cons_visio4">MAR 005 √âv√©nement</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CONTR√îLE -->
                    <div class="subtheme-section controle">
                        <h4 style="color: #10b981; margin: 0 0 15px 0; font-size: 1.2em;">üîç CONTR√îLE</h4>
                        
                        <!-- Aptitude au placement -->
                        <h5 style="color: #374151; margin: 10px 0 8px 0;">Aptitude au placement</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_ctrl_apt1" name="expectedDocuments" value="AAP examen.docx">
                                <label for="doc_ctrl_apt1">AAP examen.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_ctrl_apt2" name="expectedDocuments" value="Activit√© ind√©pendante durable.docx">
                                <label for="doc_ctrl_apt2">Activit√© ind√©pendante durable.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_ctrl_apt3" name="expectedDocuments" value="Checklist AAP.docx">
                                <label for="doc_ctrl_apt3">Checklist AAP.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_ctrl_apt4" name="expectedDocuments" value="Recherches d'emploi.docx">
                                <label for="doc_ctrl_apt4">Recherches d'emploi.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_ctrl_apt5" name="expectedDocuments" value="MAR 011 Demande √©valuation aptitude DJ">
                                <label for="doc_ctrl_apt5">MAR 011 Demande √©valuation aptitude DJ</label>
                            </div>
                        </div>
                        
                        <!-- Restitution des recherches d'emploi -->
                        <h5 style="color: #374151; margin: 15px 0 8px 0;">Restitution des recherches d'emploi</h5>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_ctrl_rest1" name="expectedDocuments" value="Recherches d'emploi.docx">
                                <label for="doc_ctrl_rest1">Recherches d'emploi.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_ctrl_rest2" name="expectedDocuments" value="RPE - Arr√™t du 15 ao√ªt 2017 - CHAS.pdf">
                                <label for="doc_ctrl_rest2">RPE - Arr√™t du 15 ao√ªt 2017 - CHAS.pdf</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_ctrl_rest3" name="expectedDocuments" value="RPE - Note diminution en cas d'incapacit√© partiel ou GI.docx">
                                <label for="doc_ctrl_rest3">RPE - Note diminution en cas d'incapacit√© partiel ou GI.docx</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_ctrl_rest4" name="expectedDocuments" value="DOC 010 Note DJ - Recherches d'emploi avant ch√¥mage">
                                <label for="doc_ctrl_rest4">DOC 010 Note DJ - Recherches d'emploi avant ch√¥mage</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_ctrl_rest5" name="expectedDocuments" value="MAR 008 RPE Contr√¥le">
                                <label for="doc_ctrl_rest5">MAR 008 RPE Contr√¥le</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="doc_ctrl_rest6" name="expectedDocuments" value="MAR 010 Management transmission au DJ">
                                <label for="doc_ctrl_rest6">MAR 010 Management transmission au DJ</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Compl√©ment d'information -->
                <div class="question-group">
                    <label for="additionalInfo">Compl√©ment d'information</label>
                    <p class="help-text">Pr√©cisions suppl√©mentaires ou commentaires sur la r√©ponse attendue (optionnel)</p>
                    <textarea id="additionalInfo" name="additionalInfo" 
                              placeholder="Informations compl√©mentaires..."></textarea>
                </div>
                
                <!-- Commentaires -->
                <div class="question-group">
                    <label for="comments">Commentaires additionnels</label>
                    <p class="help-text">Remarques, suggestions, observations...</p>
                    <textarea id="comments" name="comments" 
                              placeholder="Commentaires optionnels..."></textarea>
                </div>
                
                <div class="button-group">
                    <button type="button" class="btn-save" onclick="saveForm()">
                        üíæ Sauvegarder cette question
                    </button>
                    <button type="button" class="btn-view" onclick="viewSavedQuestions()">
                        üëÄ Voir mes questions (<span id="questionCount">0</span>)
                    </button>
                    <button type="button" class="btn-export" onclick="exportToPDF()">
                        üìÑ Exporter en PDF
                    </button>
                    <button type="button" class="btn-send" onclick="exportToGoogleForms()">
                        üì§ Envoyer vers Google Forms
                    </button>
                    <button type="button" class="btn-clear" onclick="clearForm()">
                        üóëÔ∏è Vider le formulaire
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal pour afficher les questions sauvegard√©es -->
    <div id="questionsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìã Mes Questions Sauvegard√©es</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Le contenu sera g√©n√©r√© dynamiquement -->
            </div>
        </div>
    </div>

    <script>
        // Configuration Google Sheets
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxaRphk7nGTff4Zmf1Uv-merKLCdsjupFXediFGNAPoi8BqRPqLOiItsP2MVpVStm82/exec';
        
        // Configuration Google Forms (URL mise √† jour)
        const GOOGLE_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSfnrld7MJR8uG4iiJDlbMDRcjTBWiwaN1gySWtsENVKS3I1FA/formResponse';
        
        let savedQuestions = JSON.parse(localStorage.getItem('chatbotQuestions') || '[]');
        
        // Mise √† jour de la barre de progression
        function updateProgress() {
            const progress = Math.min((savedQuestions.length / 5) * 100, 100);
            document.getElementById('progressFill').style.width = progress + '%';
        }
        
        // Mise √† jour du compteur de questions
        function updateQuestionCount() {
            const count = savedQuestions.length;
            document.getElementById('questionCount').textContent = count;
        }
        
        // Affichage des messages de statut
        function showMessage(message, type = 'success') {
            const messageDiv = document.getElementById('statusMessage');
            messageDiv.innerHTML = `<div class="${type}">${message}</div>`;
            setTimeout(() => messageDiv.innerHTML = '', 5000);
        }
        
        // Mise √† jour du compteur de questions dans le formulaire
        function updateQuestionCounter() {
            const questionSelect = document.getElementById('questionNum');
            const counter = document.getElementById('questionNumber');
            
            questionSelect.addEventListener('change', function() {
                counter.textContent = this.value || '1';
            });
        }

        // Fonction pour ouvrir la modal des questions sauvegard√©es
        function viewSavedQuestions() {
            const modal = document.getElementById('questionsModal');
            const modalBody = document.getElementById('modalBody');
            
            if (savedQuestions.length === 0) {
                modalBody.innerHTML = `
                    <div class="no-questions">
                        <h3>Aucune question sauvegard√©e</h3>
                        <p>Vous n'avez pas encore sauvegard√© de questions. Remplissez le formulaire et cliquez sur "Sauvegarder cette question" pour commencer.</p>
                    </div>
                `;
            } else {
                // G√©n√©rer le r√©sum√©
                const userNames = [...new Set(savedQuestions.map(q => q.userName))];
                const totalQuestions = savedQuestions.length;
                const completedQuestions = new Set(savedQuestions.map(q => q.questionNum)).size;
                
                let summaryHTML = `
                    <div class="questions-summary">
                        <div class="summary-item">
                            <span class="summary-number">${totalQuestions}</span>
                            <span class="summary-label">Questions sauvegard√©es</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-number">${completedQuestions}</span>
                            <span class="summary-label">Questions uniques</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-number">${userNames.length}</span>
                            <span class="summary-label">Utilisateur(s)</span>
                        </div>
                    </div>
                `;
                
                // G√©n√©rer les cartes de questions (version simplifi√©e pour √©viter les erreurs JavaScript)
                let questionsHTML = '';
                savedQuestions.forEach((question, index) => {
                    const shortQuestion = question.questionAsked && question.questionAsked.length > 100 ? 
                        question.questionAsked.substring(0, 100) + '...' : (question.questionAsked || 'N/A');
                    const shortResponse = question.botResponse && question.botResponse.length > 100 ? 
                        question.botResponse.substring(0, 100) + '...' : (question.botResponse || 'N/A');
                    
                    const encodedQuestion = encodeURIComponent(question.questionAsked || '');
                    const encodedResponse = encodeURIComponent(question.botResponse || '');
                    
                    questionsHTML += `
                        <div class="question-card">
                            <div class="question-header">
                                <h3 class="question-title">Question ${question.questionNum || 'N/A'}</h3>
                                <span class="question-date">${question.date || 'N/A'}</span>
                            </div>
                            <div class="question-details">
                                <div class="detail-row">
                                    <span class="detail-label">Utilisateur:</span>
                                    <span class="detail-content">${question.userName || 'N/A'}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Th√®mes:</span>
                                    <span class="detail-content">${question.themes || 'N/A'}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Question:</span>
                                    <span class="detail-content long" id="question-${index}">
                                        ${shortQuestion}
                                        ${question.questionAsked && question.questionAsked.length > 100 ? 
                                            `<div class="expand-btn" onclick="toggleExpand('question-${index}', '${encodedQuestion}')">Voir plus</div>` : ''}
                                    </span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">R√©ponse:</span>
                                    <span class="detail-content long" id="response-${index}">
                                        ${shortResponse}
                                        ${question.botResponse && question.botResponse.length > 100 ? 
                                            `<div class="expand-btn" onclick="toggleExpand('response-${index}', '${encodedResponse}')">Voir plus</div>` : ''}
                                    </span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Documents:</span>
                                    <span class="detail-content">${question.expectedDocuments || 'Aucun document s√©lectionn√©'}</span>
                                </div>
                                ${question.additionalInfo ? `
                                <div class="detail-row">
                                    <span class="detail-label">Infos:</span>
                                    <span class="detail-content">${question.additionalInfo}</span>
                                </div>` : ''}
                                ${question.comments ? `
                                <div class="detail-row">
                                    <span class="detail-label">Commentaires:</span>
                                    <span class="detail-content">${question.comments}</span>
                                </div>` : ''}
                            </div>
                        </div>
                    `;
                });
                
                modalBody.innerHTML = summaryHTML + questionsHTML;
            }
            
            modal.style.display = 'block';
        }

        // Fonction pour fermer la modal
        function closeModal() {
            document.getElementById('questionsModal').style.display = 'none';
        }

        // Fonction pour d√©velopper/r√©duire le texte long (version simplifi√©e)
        function toggleExpand(elementId, fullText) {
            const element = document.getElementById(elementId);
            if (element && element.classList.contains('expanded')) {
                // R√©duire
                const shortText = fullText.length > 100 ? fullText.substring(0, 100) + '...' : fullText;
                element.innerHTML = shortText + '<div class="expand-btn" onclick="toggleExpand(\'' + elementId + '\', \'' + encodeURIComponent(fullText) + '\')">Voir plus</div>';
                element.classList.remove('expanded');
            } else if (element) {
                // D√©velopper
                element.innerHTML = decodeURIComponent(fullText) + '<div class="expand-btn" onclick="toggleExpand(\'' + elementId + '\', \'' + encodeURIComponent(fullText) + '\')">Voir moins</div>';
                element.classList.add('expanded');
            }
        }

        // Fermer la modal en cliquant √† c√¥t√©
        window.onclick = function(event) {
            const modal = document.getElementById('questionsModal');
            if (event.target == modal) {
                closeModal();
            }
        }
        
        // Sauvegarde d'une question
        function saveForm() {
            const form = document.getElementById('chatbotForm');
            const formData = new FormData(form);
            
            // V√©rification des champs obligatoires
            const required = ['userName', 'questionNum', 'questionAsked', 'botResponse'];
            const missing = required.filter(field => !formData.get(field));
            
            // V√©rification des documents (au moins un coch√©)
            const expectedDocs = Array.from(document.querySelectorAll('input[name="expectedDocuments"]:checked')).map(cb => cb.value);
            if (expectedDocs.length === 0) missing.push('expectedDocuments');
            
            // V√©rification des th√®mes (au moins un coch√©)
            const themes = Array.from(document.querySelectorAll('input[name="themes"]:checked')).map(cb => cb.value);
            if (themes.length === 0) missing.push('themes');
            
            // V√©rification des sous-th√®mes (au moins un coch√©)
            const subThemes = Array.from(document.querySelectorAll('input[name="subThemes"]:checked')).map(cb => cb.value);
            if (subThemes.length === 0) missing.push('subThemes');
            
            if (missing.length > 0) {
                showMessage('‚ùå Veuillez remplir tous les champs obligatoires', 'warning');
                return;
            }
            
            // Cr√©ation de l'objet question
            const question = {
                id: Date.now(),
                date: new Date().toLocaleDateString('fr-FR'),
                userName: formData.get('userName'),
                questionNum: formData.get('questionNum'),
                themes: themes.join(', '),
                subThemes: subThemes.join(', '),
                questionAsked: formData.get('questionAsked'),
                botResponse: formData.get('botResponse'),
                expectedDocuments: expectedDocs.join(', '),
                additionalInfo: formData.get('additionalInfo') || '',
                comments: formData.get('comments') || ''
            };
            
            // V√©rification si cette question existe d√©j√† (m√™me utilisateur + m√™me num√©ro)
            const existingIndex = savedQuestions.findIndex(q => 
                q.userName === question.userName && q.questionNum === question.questionNum
            );
            
            if (existingIndex >= 0) {
                savedQuestions[existingIndex] = question;
                showMessage(`‚úÖ Question ${question.questionNum} mise √† jour avec succ√®s !`);
            } else {
                savedQuestions.push(question);
                showMessage(`‚úÖ Question ${question.questionNum} sauvegard√©e avec succ√®s !`);
            }
            
            // Sauvegarde locale
            localStorage.setItem('chatbotQuestions', JSON.stringify(savedQuestions));
            updateProgress();
            updateQuestionCount();
            
            // R√©initialiser le formulaire
            setTimeout(() => {
                form.reset();
                updateProgress();
            }, 1500);
        }
        
        // Envoi vers Google Sheets
        async function sendToGoogleSheets() {
            if (savedQuestions.length === 0) {
                showMessage('‚ùå Aucune question sauvegard√©e √† envoyer', 'warning');
                return;
            }
            
            if (!GOOGLE_SCRIPT_URL || GOOGLE_SCRIPT_URL === 'VOTRE_URL_SCRIPT_GOOGLE_ICI') {
                showMessage('‚ö†Ô∏è URL Google Script non configur√©e. Contactez votre administrateur.', 'warning');
                return;
            }
            
            try {
                showMessage('üì§ Envoi en cours vers Google Sheets...', 'warning');
                
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        questions: savedQuestions,
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent
                    })
                });
                
                if (response.ok) {
                    const result = await response.text();
                    showMessage('‚úÖ Donn√©es envoy√©es avec succ√®s vers Google Sheets !');
                    
                    // Option : vider les donn√©es locales apr√®s envoi r√©ussi
                    if (confirm('‚úÖ Envoi r√©ussi ! Voulez-vous vider les donn√©es locales ?')) {
                        localStorage.removeItem('chatbotQuestions');
                        savedQuestions = [];
                        document.getElementById('chatbotForm').reset();
                        updateProgress();
                        updateQuestionCount();
                        showMessage('üóëÔ∏è Donn√©es locales supprim√©es');
                    }
                } else {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                
            } catch (error) {
                console.error('Erreur envoi Google Sheets:', error);
                showMessage('‚ùå Erreur lors de l\'envoi. V√©rifiez votre connexion internet.', 'warning');
            }
        }
        
        // Export vers Google Forms
        async function exportToGoogleForms() {
            console.log('=== D√âBUT EXPORT GOOGLE FORMS ===');
            
            if (savedQuestions.length === 0) {
                showMessage('‚ùå Aucune question sauvegard√©e √† envoyer', 'warning');
                return;
            }
            
            try {
                showMessage('üì§ Envoi en cours vers Google Forms...', 'warning');
                
                let successCount = 0;
                
                for (const question of savedQuestions) {
                    console.log('Envoi question:', question.questionNum, question);
                    
                    // Cr√©er les donn√©es pour Google Forms avec vos vrais entry IDs
                    const formData = new FormData();
                    
                    formData.append('entry.2124536108', question.userName || ''); // Email
                    formData.append('entry.1139809027', question.questionNum || ''); // Num√©ro question
                    formData.append('entry.1654220128', question.themes || ''); // Th√®mes
                    formData.append('entry.235677432', question.subThemes || ''); // Sous-th√®mes
                    formData.append('entry.620424104', question.questionAsked || ''); // Question pos√©e
                    formData.append('entry.1896168519', question.botResponse || ''); // R√©ponse ChatBot
                    formData.append('entry.1217455196', question.expectedDocuments || ''); // Documents attendus
                    formData.append('entry.2014602471', question.additionalInfo || ''); // Infos compl√©mentaires
                    formData.append('entry.1998814617', question.comments || ''); // Commentaires
                    
                    // Envoyer vers Google Forms (test sans no-cors)
                    try {
                        const response = await fetch(GOOGLE_FORM_URL, {
                            method: 'POST',
                            body: formData
                            // Suppression du mode: 'no-cors' pour voir les vraies erreurs
                        });
                        
                        console.log('R√©ponse du serveur:', response.status, response.statusText);
                        
                    } catch (fetchError) {
                        console.error('Erreur fetch d√©taill√©e:', fetchError);
                        // On continue quand m√™me car Google Forms peut renvoyer une erreur CORS m√™me si √ßa marche
                    }
                    
                    successCount++;
                    console.log(`‚úÖ Question ${question.questionNum} envoy√©e avec succ√®s`);
                    
                    // Petite pause entre les envois pour √©viter la surcharge
                    await new Promise(resolve => setTimeout(resolve, 800));
                }
                
                showMessage(`‚úÖ ${successCount} question(s) envoy√©e(s) avec succ√®s vers Google Forms !`);
                console.log('=== EXPORT GOOGLE FORMS R√âUSSI ===');
                
                // Option de vidage des donn√©es locales
                if (confirm('‚úÖ Envoi r√©ussi ! Voulez-vous vider les donn√©es locales sauvegard√©es ?')) {
                    localStorage.removeItem('chatbotQuestions');
                    savedQuestions = [];
                    document.getElementById('chatbotForm').reset();
                    updateProgress();
                    updateQuestionCount();
                    showMessage('üóëÔ∏è Donn√©es locales supprim√©es');
                }
                
            } catch (error) {
                console.error('ERREUR Export Google Forms:', error);
                showMessage(`‚ùå Erreur lors de l'envoi: ${error.message}`, 'warning');
            }
        }
        
        // Export PDF simplifi√© et robuste
        function exportToPDF() {
            console.log('=== D√âBUT EXPORT PDF SIMPLIFI√â ===');
            
            if (savedQuestions.length === 0) {
                showMessage('‚ùå Aucune question sauvegard√©e √† exporter', 'warning');
                return;
            }
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                doc.setFont('helvetica');
                let yPos = 20;
                
                // Titre simple
                doc.setFontSize(16);
                doc.text('Test ChatBot - R√©ponses', 20, yPos);
                yPos += 20;
                
                // Informations utilisateur
                doc.setFontSize(12);
                doc.text(`Utilisateur: ${savedQuestions[0].userName}`, 20, yPos);
                yPos += 10;
                doc.text(`Date: ${new Date().toLocaleDateString('fr-FR')}`, 20, yPos);
                yPos += 10;
                doc.text(`Questions: ${savedQuestions.length}`, 20, yPos);
                yPos += 20;
                
                // Chaque question (version simplifi√©e)
                savedQuestions.forEach((q, i) => {
                    console.log(`Traitement question ${i + 1}`);
                    
                    // Nouvelle page si n√©cessaire
                    if (yPos > 250) {
                        doc.addPage();
                        yPos = 20;
                    }
                    
                    // Question
                    doc.setFontSize(14);
                    doc.text(`Question ${q.questionNum}`, 20, yPos);
                    yPos += 15;
                    
                    doc.setFontSize(10);
                    doc.text(`Th√®mes: ${q.themes || 'N/A'}`, 20, yPos);
                    yPos += 8;
                    doc.text(`Sous-th√®mes: ${q.subThemes || 'N/A'}`, 20, yPos);
                    yPos += 12;
                    
                    // Question pos√©e (max 2 lignes)
                    doc.text('Question pos√©e:', 20, yPos);
                    yPos += 6;
                    const qText = (q.questionAsked || 'N/A').substring(0, 100) + '...';
                    doc.text(qText, 25, yPos);
                    yPos += 12;
                    
                    // R√©ponse bot (max 2 lignes)  
                    doc.text('R√©ponse ChatBot:', 20, yPos);
                    yPos += 6;
                    const botText = (q.botResponse || 'N/A').substring(0, 100) + '...';
                    doc.text(botText, 25, yPos);
                    yPos += 12;
                    
                    // Documents attendus avec bullet points corrig√©s
                    doc.text('Documents de r√©f√©rence attendus:', 20, yPos);
                    yPos += 8;
                    
                    console.log('Documents dans la question:', q.expectedDocuments);
                    
                    if (q.expectedDocuments && q.expectedDocuments.length > 0) {
                        // Split correctement la liste de documents
                        const docsList = q.expectedDocuments.includes(', ') ? 
                            q.expectedDocuments.split(', ') : 
                            q.expectedDocuments.split(',');
                        
                        console.log('Documents apr√®s split:', docsList);
                        
                        if (docsList.length > 0 && docsList[0].trim() !== '') {
                            docsList.forEach((docName, index) => {
                                console.log(`Document ${index + 1}:`, docName);
                                
                                if (docName && docName.trim()) {
                                    // Nouvelle page si n√©cessaire
                                    if (yPos > 250) {
                                        doc.addPage();
                                        yPos = 20;
                                    }
                                    
                                    // G√©rer les noms longs avec bullet point
                                    let displayText = docName.trim();
                                    if (displayText.length > 70) {
                                        displayText = displayText.substring(0, 67) + '...';
                                    }
                                    doc.text('‚Ä¢ ' + displayText, 25, yPos);
                                    yPos += 6;
                                }
                            });
                        } else {
                            doc.text('‚Ä¢ Aucun document s√©lectionn√©', 25, yPos);
                            yPos += 6;
                        }
                    } else {
                        doc.text('‚Ä¢ Aucun document s√©lectionn√©', 25, yPos);
                        yPos += 6;
                    }
                    yPos += 10;
                    
                    // S√©parateur
                    doc.setDrawColor(200, 200, 200);
                    doc.line(20, yPos, 190, yPos);
                    yPos += 15;
                });
                
                // Sauvegarde
                const fileName = `ChatBot_Export_${new Date().toISOString().split('T')[0]}.pdf`;
                console.log('Sauvegarde:', fileName);
                doc.save(fileName);
                
                showMessage('üìÑ PDF export√© avec succ√®s !');
                console.log('=== EXPORT R√âUSSI ===');
                
            } catch (error) {
                console.error('Erreur export:', error);
                showMessage('‚ùå Erreur: ' + error.message, 'warning');
            }
        }
        
        // Vider le formulaire et les donn√©es
        function clearForm() {
            if (confirm('‚ö†Ô∏è √ätes-vous s√ªr de vouloir vider toutes les donn√©es sauvegard√©es ?')) {
                localStorage.removeItem('chatbotQuestions');
                savedQuestions = [];
                document.getElementById('chatbotForm').reset();
                updateProgress();
                updateQuestionCount();
                showMessage('üóëÔ∏è Toutes les donn√©es ont √©t√© supprim√©es');
            }
        }
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
            updateQuestionCounter();
            updateQuestionCount();
            
            if (savedQuestions.length > 0) {
                showMessage(`üìä ${savedQuestions.length} question(s) d√©j√† sauvegard√©e(s)`);
            }
        });
        
        // Sauvegarde automatique en cas de fermeture accidentelle
        window.addEventListener('beforeunload', function(e) {
            const form = document.getElementById('chatbotForm');
            const hasData = Array.from(new FormData(form)).some(([key, value]) => value.trim() !== '');
            
            if (hasData) {
                const message = 'Vous avez des donn√©es non sauvegard√©es. Voulez-vous vraiment quitter ?';
                e.returnValue = message;
                return message;
            }
        });
    </script>
</body>
</html>
